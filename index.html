<html>
  <head>
    <meta name="viewport" content="width=device-width">
    <style>
      html, body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <iframe
      id="nemId"
      style="width: 100vw; height: 100vh;"
    ></iframe>
    <script>
      const nemIdFrame = document.getElementById('nemId');

      nemIdFrame.src = `https://appletk.danid.dk/launcher/lmt/${Date.now()}`;

      const receiveMessage = (event) => {
        console.log(event);
        alert(`${event.origin}, ${JSON.stringify(event.data)}`);

        const { command, content } = JSON.parse(event.data);

        if (event.origin === 'https://appletk.danid.dk') {
          if (window.ReactNativeWebView != null) {
            alert(`RNWV: ${typeof window.ReactNativeWebView.postMessage}, ${JSON.stringify(Object.keys(window.ReactNativeWebView))}`);
            window.ReactNativeWebView.postMessage(event.data);
            alert('Sent!');
          } else {
            alert('RNWebView is null!');
          }
        }
      };

      const sendNemIdMessage = (message) => {
        alert('Sending message to NemID');
        window.ReactNativeWebView.postMessage(message);

        nemIdFrame.contentWindow.postMessage(
          message,
          'https://appletk.danid.dk/',
        );
      };
      window.addEventListener("message", receiveMessage, true);
      window.onerror = (...args) => alert('global error - ' + JSON.stringify(args));
    </script>
  </body>
</html>
